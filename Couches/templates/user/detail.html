{% extends "base.html" %}

{% load i18n %}

{% block content %}

<div class="container">
	<div class="row-fluid page-header">
			<h1> {{ couches_profile.get_best_identifier }} <small> Class of {{ couches_profile.graduation_year }} </small> </h1>
	</div>
	{% if couches_profile.couches.all %}
	<div class="row-fluid">
		<div class="col-md-6" id="map-container">
			<div id="profile-map">
			</div>
		</div>
		<div class="col-md-6" id="addresses-container">
				<h3> Addresses </h3>
					<dl class="accordion">
						{% for couch in couches_profile.couches.all %}
						<dt><a href="" > {{ couch.address }} </a> </dt>
						<dd>{{ couch.formatted_address }}</dd>
						{% endfor %}
					</dl>
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<ul class="list-inline">
				<li>
					<a href="/couches/couch/create" > Add a new couch </a>
				</li>
			</ul>
		</div>
	</div>
	{% endif %}
	<div class="row-fluid">
		{% if couches_profile.contact_information %}
			<div class="col-md-4">
				<h3> Contact Information </h3>
				<p> 
				{{ couches_profile.contact_information }}
				</p>
			</div>
		{% endif %}
		{% if couches_profile.description %}
		<div class="col-md-4">
			<h3> Description </h3>
			<p>
			{{ couches_profile.description }}
			</p>
		</div>
		{% endif %}
		{% if user.is_authenticated %}
			{% comment %}
				Only authenticated users should be able to see and send e-mails. TODO: Users get to specify whether their e-mail is visible to everyone or not.
			{% endcomment %}
			<div class="col-md-4">
				<h3> E-mail </h3>
				<p> <a href="mailto:{{ couches_profile.email }}"> {{ couches_profile.email }} </a> </p>
			</div>
		{% endif %}
	</div>
	<div class="row-fluid text-center" id="account-edit">
			<ul class="list-inline">
				<li> <strong> <small> Edit Profile: </small> </strong> </li>
	        	<li><small> <a href="{% url 'account_change_password' %}">{% trans 'Change password' %}</a></small></li>
	        	<li><small> <a href="{% url 'account_email' %}">{% trans 'Configure email' %}</a></small></li>
	        	<li><small> <a href="{% url 'account_reset_password' %}">{% trans 'Reset password' %}</a></small></li>
	    	</ul>
	</div>
</div>

{% if couches_profile.couches.all %}
	<style>
		#profile-map{
			height: 250px;
			width: 100%;
		}
		#addresses-container{
			min-height: 200px;
		}
		.accordion a{
			color: black;
		}
		#account-edit{
			color: grey;
		}
		#account-edit a{
			color: grey;
		}
	</style>
	<script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1cJ3PQ6l2bR5Xspx6Qg5ROAxmPLjL0CQ">
    </script>
    <script type="text/javascript">
    	(function($) {
    
		  var allPanels = $('.accordion > dd').hide();
		    
		  $('.accordion > dt > a').click(function() {
		    allPanels.slideUp();
		    $(this).parent().next().slideDown();
		    return false;
		  });

		})(jQuery);

        function initialize() {

            var mapStyles = [
                {
                    "featureType": "water",
                    "elementType": "geometry.fill"
                },{
                    "featureType": "landscape"
                },{
                    "elementType": "labels",
                    "stylers": [
                        { "visibility": "on" }
                    ]
                },{
                    "featureType": "administrative",
                    "stylers": [
                        { "visibility": "off" }
                    ]
                }
            ]

            var mapOptions = {
                center: new google.maps.LatLng(0, 0),
                zoom: 1,
                disableDefaultUI: true,
                styles: mapStyles
            };
            var map = new google.maps.Map(document.getElementById("profile-map"),
                    mapOptions);

            {% for couch in couches_profile.couches.all %}
                var couch{{ forloop.counter }} = new google.maps.Marker({
                    position: new google.maps.LatLng({{ couch.latitude }}, {{ couch.longitude }}),
                    map: map,
                    url: "/couches/couch/{{couch.pk}}/delete",
                    title:"Delete this couch"
                });

                google.maps.event.addListener(couch{{ forloop.counter }}, 'click', function() {
                    window.location.href = couch{{ forloop.counter }}.url;
                });

            {% endfor %}
        }

        google.maps.event.addDomListener(window, 'load', initialize);

    </script>

{% endif %}

{% endblock %}